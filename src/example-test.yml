version: 0.1
name: ExampleApp
servers: 
   - nginx_instance_v1:
      type: nginx
      name : my_nginx_server
      ports: [80,443] # Expose HTTP and HTTPS ports

databases:
   - postgresql_instance_v1:
      type: postgresql
      name: postgre_name
      ports: [6379]
      dockerc:
        image: postgres
        container_name: my_postgre_container
        volumes:
           - ./postgres-data:/var/lib/postgresql/data
        environment:
          POSTGRES_PASSWORD: machine
          POSTGRES_USER: doom
          POSTGRES_DB: dev
   - redis_instance_v1:
      name: my_redis
      type: redis
      user: 
        username: doom
        password: machine
      ports: [6379]
eventbus:
   - rabbitmq_instance_v1:
      type: rabbitmq
      name: rabbit_name
      dockerc:
        image: rabbitmq:3-management-alpine
        container_name: rabbitmqc
        volumes:
          - rabbit-volume:/var/lib/rabbitmq
        ports:
          - 15672
          - 5672
          - 5671
        environment:
          RABBITMQ_DEFAULT_PASS: machine
          RABBITMQ_DEFAULT_USER: doom
        healthcheck:
          test: ["CMD", "curl", "-f", "http://localhost:15672"]
          interval: 30s
          timeout: 10s
          retries: 5  
identity_services:
   - identityserver_v1:
      type: identityserver4
      name: my_identity_name
      eventbus: 
        bus: rabbit_name
        with: masstransit
      ports: [5000]
      server: my_nginx_server
      docker_options:
        build: in_container # OR in_dev_machine(copy publish directory)
      logging: serilog
      database: 
        provider: postgre_name
        database_name: my_identity_db
        create_database: true
        seed_admin_account: true
        admin_account:
          email: admin@admin.com
          password: DooMachine-1
          roles:
           - superadmin
           - admin
api_services: 
   - foo_api:
      type: dotnet_web_api
      name: my_foo_api
      docker_options:
        build: build_container # OR build_dev (copy publish directory)
      eventbus: 
        bus_instance: rabbit_name
        implement_with: masstransit
      authorization:
        issuer: my_identity_name
        api_secret: my_identity_name_secret
        avaliable_scopes:
         - openid
         - profile
         - email
         - foo_api_read
         - foo_api_write
         - foo_api_fullaccess
      database: 
        provider: postgre_name
        database_name: foo_api_db
        create_database: true
      cache:
        type: memory
      ports: [7000]
      server: my_nginx_server
      logging: serilog
   - bar_api:
      type: dotnet_web_api
      name: MyBarApi
      authorization:
        issuer: my_identity_name
        secret: my_identity_name_bar_secret
        avaliable_scopes:
         - openid
         - profile
         - email
         - foo_api_read
         - foo_api_write
         - foo_api_fullaccess
      database: 
        provider: postgre_name
        database_name: bar_api_db
        context_name: BarApiContext
        create_database: true
      cache:
        type: redis
        redis_options: 
          redis_server: my_redis
          redis_instance_name: master
      eventbus: 
        bus_instance: rabbit_name
      ports: [7000]
      server: my_nginx_server
      logging: serilog
clients: 
   - web_1:
      type: angular
      name: my_angular_client
      add_npm_packages:
       - name: '@ngrx/store'
         version: '6.0.1'
      identity: # using angular-oidc-client library
        issuer: identityserver_v1
        flow: implicit
        scopes: 
         - foo_api_fullaccess
         - bar_api_readonly
      ports: [4200]
      server: my_nginx_server

      